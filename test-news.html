<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - Not√≠cias TRT</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-title {
            color: #8B4513;
            margin-bottom: 15px;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .status.success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .status.error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .status.info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        button {
            background: #8B4513;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #A0522D; }
        .news-display {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin-top: 15px;
            max-height: 400px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ Teste de Carregamento das Not√≠cias TRT</h1>
        
        <div class="test-section">
            <h2 class="test-title">Teste de Conectividade</h2>
            <button onclick="testConnectivity()">Testar Conectividade</button>
            <div id="connectivity-status"></div>
        </div>
        
        <div class="test-section">
            <h2 class="test-title">Teste de Carregamento das Not√≠cias</h2>
            <button onclick="testNewsLoading()">Carregar Not√≠cias TRT</button>
            <button onclick="testNewsLoadingSTJ()">Carregar Not√≠cias STJ</button>
            <div id="news-status"></div>
            <div id="news-display" class="news-display"></div>
        </div>
        
        <div class="test-section">
            <h2 class="test-title">Teste de Performance</h2>
            <button onclick="testPerformance()">Testar Performance</button>
            <div id="performance-status"></div>
        </div>
        
        <div class="test-section">
            <h2 class="test-title">Logs de Debug</h2>
            <button onclick="clearLogs()">Limpar Logs</button>
            <div id="debug-logs" style="background: #000; color: #0f0; padding: 10px; border-radius: 4px; font-family: monospace; max-height: 200px; overflow-y: auto;"></div>
        </div>
    </div>

    <script>
        // Fun√ß√£o para adicionar logs
        function addLog(message, type = 'info') {
            const logsDiv = document.getElementById('debug-logs');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.style.color = type === 'error' ? '#ff6b6b' : type === 'success' ? '#51cf66' : '#74c0fc';
            logEntry.textContent = `[${timestamp}] ${message}`;
            logsDiv.appendChild(logEntry);
            logsDiv.scrollTop = logsDiv.scrollHeight;
        }

        // Fun√ß√£o para mostrar status
        function showStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        // Teste de conectividade
        async function testConnectivity() {
            addLog('Iniciando teste de conectividade...');
            showStatus('connectivity-status', 'üîÑ Testando conectividade...', 'info');
            
            try {
                const startTime = performance.now();
                const response = await fetch('https://www.google.com', { 
                    method: 'HEAD',
                    mode: 'no-cors'
                });
                const endTime = performance.now();
                const duration = Math.round(endTime - startTime);
                
                showStatus('connectivity-status', `‚úÖ Conectividade OK! Tempo de resposta: ${duration}ms`, 'success');
                addLog(`Conectividade testada com sucesso em ${duration}ms`);
            } catch (error) {
                showStatus('connectivity-status', `‚ùå Erro de conectividade: ${error.message}`, 'error');
                addLog(`Erro de conectividade: ${error.message}`, 'error');
            }
        }

        // Teste de carregamento das not√≠cias TRT
        async function testNewsLoading() {
            addLog('Iniciando teste de carregamento das not√≠cias TRT...');
            showStatus('news-status', 'üîÑ Carregando not√≠cias do TRT...', 'info');
            
            const startTime = performance.now();
            
            try {
                // Simular o processo de carregamento das not√≠cias TRT
                const proxyUrls = [
                    'https://api.allorigins.win/raw?url=',
                    'https://cors-anywhere.herokuapp.com/',
                    'https://thingproxy.freeboard.io/fetch/'
                ];
                
                const trtUrl = 'https://www.trt4.jus.br/portais/trt4/modulos/noticias/Jur%C3%ADdica/0';
                let html = null;
                let workingProxy = null;
                
                for (let i = 0; i < proxyUrls.length; i++) {
                    try {
                        addLog(`Tentando proxy ${i + 1}: ${proxyUrls[i]}`);
                        const fullUrl = proxyUrls[i] + encodeURIComponent(trtUrl);
                        
                        const response = await fetch(fullUrl, { 
                            cache: 'no-store',
                            headers: {
                                'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'
                            }
                        });
                        
                        if (response.ok) {
                            html = await response.text();
                            workingProxy = proxyUrls[i];
                            addLog(`‚úÖ Proxy ${i + 1} funcionou!`);
                            break;
                        } else {
                            addLog(`‚ùå Proxy ${i + 1} falhou: ${response.status}`, 'error');
                        }
                    } catch (error) {
                        addLog(`‚ùå Proxy ${i + 1} erro: ${error.message}`, 'error');
                    }
                }
                
                if (html) {
                    const endTime = performance.now();
                    const duration = Math.round(endTime - startTime);
                    
                    // Simular parsing das not√≠cias
                    const newsCount = Math.floor(Math.random() * 5) + 3; // 3-7 not√≠cias simuladas
                    const mockNews = [];
                    
                    for (let i = 0; i < newsCount; i++) {
                        mockNews.push({
                            title: `Not√≠cia TRT ${i + 1} - Teste de carregamento`,
                            description: 'Esta √© uma not√≠cia simulada para teste de performance e conectividade.',
                            date: new Date().toLocaleDateString('pt-BR'),
                            link: trtUrl
                        });
                    }
                    
                    showStatus('news-status', `‚úÖ Not√≠cias TRT carregadas com sucesso! (${newsCount} not√≠cias em ${duration}ms)`, 'success');
                    displayNews(mockNews, 'TRT');
                    addLog(`Not√≠cias TRT carregadas com sucesso em ${duration}ms usando proxy: ${workingProxy}`);
                } else {
                    throw new Error('Todos os proxies falharam');
                }
                
            } catch (error) {
                const endTime = performance.now();
                const duration = Math.round(endTime - startTime);
                
                showStatus('news-status', `‚ùå Falha ao carregar not√≠cias TRT: ${error.message}`, 'error');
                addLog(`Falha ao carregar not√≠cias TRT em ${duration}ms: ${error.message}`, 'error');
            }
        }

        // Teste de carregamento das not√≠cias STJ
        async function testNewsLoadingSTJ() {
            addLog('Iniciando teste de carregamento das not√≠cias STJ...');
            showStatus('news-status', 'üîÑ Carregando not√≠cias do STJ...', 'info');
            
            const startTime = performance.now();
            
            try {
                const rssUrl = 'https://res.stj.jus.br/hrestp-c-portalp/RSS.xml';
                const proxyUrls = [
                    'https://api.allorigins.win/raw?url=',
                    'https://cors-anywhere.herokuapp.com/',
                    'https://thingproxy.freeboard.io/fetch/'
                ];
                
                let xmlText = null;
                let workingProxy = null;
                
                // Tentar direto primeiro
                try {
                    addLog('Tentando conex√£o direta com STJ...');
                    const response = await fetch(rssUrl, { 
                        cache: 'no-store',
                        headers: {
                            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'
                        }
                    });
                    
                    if (response.ok) {
                        xmlText = await response.text();
                        addLog('‚úÖ Conex√£o direta com STJ funcionou!');
                    }
                } catch (error) {
                    addLog(`‚ùå Conex√£o direta falhou: ${error.message}`, 'error');
                }
                
                // Se direto falhou, tentar proxies
                if (!xmlText) {
                    for (let i = 0; i < proxyUrls.length; i++) {
                        try {
                            addLog(`Tentando proxy ${i + 1} para STJ: ${proxyUrls[i]}`);
                            const fullUrl = proxyUrls[i] + encodeURIComponent(rssUrl);
                            
                            const response = await fetch(fullUrl, { 
                                cache: 'no-store',
                                headers: {
                                    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'
                                }
                            });
                            
                            if (response.ok) {
                                xmlText = await response.text();
                                workingProxy = proxyUrls[i];
                                addLog(`‚úÖ Proxy ${i + 1} para STJ funcionou!`);
                                break;
                            } else {
                                addLog(`‚ùå Proxy ${i + 1} para STJ falhou: ${response.status}`, 'error');
                            }
                        } catch (error) {
                            addLog(`‚ùå Proxy ${i + 1} para STJ erro: ${error.message}`, 'error');
                        }
                    }
                }
                
                if (xmlText) {
                    const endTime = performance.now();
                    const duration = Math.round(endTime - startTime);
                    
                    // Simular parsing RSS
                    const newsCount = Math.floor(Math.random() * 8) + 5; // 5-12 not√≠cias simuladas
                    const mockNews = [];
                    
                    for (let i = 0; i < newsCount; i++) {
                        mockNews.push({
                            title: `Not√≠cia STJ ${i + 1} - Teste de carregamento RSS`,
                            description: 'Esta √© uma not√≠cia simulada do STJ para teste de performance e conectividade.',
                            date: new Date().toLocaleDateString('pt-BR'),
                            link: 'https://www.stj.jus.br'
                        });
                    }
                    
                    showStatus('news-status', `‚úÖ Not√≠cias STJ carregadas com sucesso! (${newsCount} not√≠cias em ${duration}ms)`, 'success');
                    displayNews(mockNews, 'STJ');
                    addLog(`Not√≠cias STJ carregadas com sucesso em ${duration}ms${workingProxy ? ` usando proxy: ${workingProxy}` : ' (conex√£o direta)'}`);
                } else {
                    throw new Error('Todos os m√©todos de conex√£o falharam');
                }
                
            } catch (error) {
                const endTime = performance.now();
                const duration = Math.round(endTime - startTime);
                
                showStatus('news-status', `‚ùå Falha ao carregar not√≠cias STJ: ${error.message}`, 'error');
                addLog(`Falha ao carregar not√≠cias STJ em ${duration}ms: ${error.message}`, 'error');
            }
        }

        // Fun√ß√£o para exibir as not√≠cias
        function displayNews(news, source) {
            const displayDiv = document.getElementById('news-display');
            displayDiv.innerHTML = `
                <h3>üì∞ Not√≠cias ${source} Carregadas (${news.length})</h3>
                ${news.map((item, index) => `
                    <div style="border: 1px solid #ddd; padding: 10px; margin: 10px 0; border-radius: 4px;">
                        <strong>${item.title}</strong><br>
                        <small style="color: #666;">${item.date}</small><br>
                        <p style="margin: 5px 0;">${item.description}</p>
                        <a href="${item.link}" target="_blank" style="color: #8B4513;">Ver mais</a>
                    </div>
                `).join('')}
            `;
        }

        // Teste de performance
        async function testPerformance() {
            addLog('Iniciando teste de performance...');
            showStatus('performance-status', 'üîÑ Testando performance...', 'info');
            
            const tests = [
                { name: 'Teste de Lat√™ncia', func: testLatency },
                { name: 'Teste de Throughput', func: testThroughput },
                { name: 'Teste de Mem√≥ria', func: testMemory }
            ];
            
            let results = [];
            
            for (const test of tests) {
                try {
                    addLog(`Executando: ${test.name}`);
                    const result = await test.func();
                    results.push({ name: test.name, ...result });
                } catch (error) {
                    addLog(`‚ùå ${test.name} falhou: ${error.message}`, 'error');
                }
            }
            
            const summary = results.map(r => `${r.name}: ${r.value}${r.unit}`).join(', ');
            showStatus('performance-status', `‚úÖ Testes de performance conclu√≠dos: ${summary}`, 'success');
            addLog(`Testes de performance conclu√≠dos: ${summary}`);
        }

        async function testLatency() {
            const start = performance.now();
            await new Promise(resolve => setTimeout(resolve, 10));
            const end = performance.now();
            return { value: Math.round(end - start), unit: 'ms' };
        }

        async function testThroughput() {
            const start = performance.now();
            const data = new Array(10000).fill('test');
            const processed = data.map(item => item.toUpperCase());
            const end = performance.now();
            return { value: Math.round(10000 / (end - start)), unit: 'ops/ms' };
        }

        function testMemory() {
            if (performance.memory) {
                const used = Math.round(performance.memory.usedJSHeapSize / 1024 / 1024);
                return { value: used, unit: 'MB' };
            }
            return { value: 'N/A', unit: '' };
        }

        // Limpar logs
        function clearLogs() {
            document.getElementById('debug-logs').innerHTML = '';
            addLog('Logs limpos');
        }

        // Inicializa√ß√£o
        window.addEventListener('load', () => {
            addLog('P√°gina de teste carregada');
            addLog('Use os bot√µes acima para testar diferentes funcionalidades');
        });
    </script>
</body>
</html>
